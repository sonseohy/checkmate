image: node:22.12.0

stages:
  - build
  - deploy

before_script:
  - echo "GitLab CI/CD ì‹œì‘!"
  - node -v
  - npm -v

# ë¹Œë“œ ë‹¨ê³„
build_checkmate_fe:
  stage: build
  only:
    - fe
  script:
    - cd checkmate-fe
    - echo "$FRONTEND_ENV" > .env
    - echo ".env íŒŒì¼ ë‚´ìš© í™•ì¸"
    - cat .env
    - npm ci
    - npm run build
  artifacts:
    paths:
      - checkmate-fe/dist

# ë¡œì»¬ Dockerë¡œ ìë™ ë°°í¬
deploy_checkmate_fe:
  stage: deploy
  only:
    - fe
  script:
    - echo "ğŸš€ Docker ë°°í¬ ì‹œì‘"
    - cd checkmate-fe
    - docker stop checkmate-fe-container || true
    - docker rm checkmate-fe-container || true
    - docker rmi checkmate-fe || true
    - docker build -t checkmate-fe .
    - docker run -d --name checkmate-fe-container -p 3000:80 checkmate-fe
